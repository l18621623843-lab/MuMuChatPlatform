# å®šä¹‰åŸºç¡€é•œåƒå˜é‡å¹¶è®¾ç½®é»˜è®¤å€¼
# ä½¿ç”¨å®˜æ–¹nginx Alpineé•œåƒï¼ˆè½»é‡çº§ä¸”é€‚åˆä½œä¸ºåŸºç¡€é•œåƒï¼‰
ARG BASE_IMAGE=nginx:1.27.3-alpine

# ä½¿ç”¨å˜é‡ä½œä¸ºåŸºç¡€é•œåƒ
FROM ${BASE_IMAGE}

# author
MAINTAINER xueyi

# è®¾å®šæ—¶åŒº
ENV TZ=Asia/Shanghai
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

# æŒ‡å®šè·¯å¾„
WORKDIR /home/xueyi/projects/xueyi-ui

# å¤åˆ¶æ„å»ºäº§ç‰©åˆ°æ ‡å‡†è·¯å¾„
COPY ./dist .

# å¤åˆ¶ Nginx é…ç½®æ–‡ä»¶
COPY ./nginx/conf/nginx.conf /etc/nginx/nginx.conf

# æš´éœ²ç«¯å£
EXPOSE 80

# å°†/home/xueyi/projects/xueyi-ui/assets/index.js å’Œ/home/xueyi/projects/xueyi-ui/_app.config.jsä¸­çš„"$vg_base_url"æ›¿æ¢ä¸ºç¯å¢ƒå˜é‡ä¸­çš„VG_BASE_URL,$vg_sub_domain æ›¿æ¢æˆVG_SUB_DOMAINï¼Œ$vg_default_useræ›¿æ¢æˆVG_DEFAULT_USERï¼Œ$vg_default_passwordæ›¿æ¢æˆVG_DEFAULT_PASSWORD è€Œåå¯åŠ¨nginx
CMD sed -i "s|__vg_base_url|$VG_BASE_URL|g" /home/xueyi/projects/xueyi-ui/assets/entry/index-*.js /home/xueyi/projects/xueyi-ui/_app.config.js && \
    nginx -g 'daemon off;'
RUN echo "ğŸ‰ æ¶ ğŸ‰ è®¾ ğŸ‰ æˆ ğŸ‰ åŠŸ ğŸ‰"

# å¯é€šè¿‡ "docker build -t ç‰ˆæœ¬å· --build-arg BASE_IMAGE=è‡ªå®šä¹‰é•œåƒ ." è‡ªå®šä¹‰é•œåƒæ‰“åŒ…é•œåƒ
